# vuln_exploit.py

import socket
import base64
import hashlib
from Crypto.Cipher import AES
import os

class Exploit:
    def __init__(self, target_ip, target_port):
        self.target_ip = target_ip
        self.target_port = target_port
        self.secret_key = hashlib.sha256(b'super_secret_key').digest()

    def encrypt(self, plaintext):
        cipher = AES.new(self.secret_key, AES.MODE_EAX)
        nonce = cipher.nonce
        ciphertext, tag = cipher.encrypt_and_digest(plaintext)
        return base64.b64encode(nonce + ciphertext)

    def fake_login(self, username, password):
        print(f"Attempting login as {username}")
        if username == "admin" and password == "password123":
            print("Login successful!")
            return True
        else:
            print("Login failed! Attempting default credentials...")
            return self.try_default_login()

    def try_default_login(self):
        username = "default_admin"
        password = "default_pass"
        if username == "default_admin" and password == "default_pass":
            print("Default credentials successful!")
            return True
        else:
            print("Default credentials failed!")
            return False

    def send_payload(self, payload):
        try:
            s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
            s.connect((self.target_ip, self.target_port))
            print(f"Sending payload: {payload}")
            s.sendall(payload)
            response = s.recv(1024)
            print(f"Received response: {response.decode()}")
            s.close()
        except Exception as e:
            print(f"Error sending payload: {e}")

    def execute_exploit(self):
        if self.fake_login("admin", "wrong_password"):
            exploit_payload = b"GET /exploit HTTP/1.1\r\nHost: " + self.target_ip.encode() + b"\r\n\r\n"
            encrypted_payload = self.encrypt(exploit_payload)
            print(f"Encrypted payload: {encrypted_payload}")
            self.send_payload(encrypted_payload)
        else:
            print("Exploit failed. Unable to log in.")

if __name__ == "__main__":
    target_ip = "192.168.0.10"
    target_port = 8080
    exploit = Exploit(target_ip, target_port)
    exploit.execute_exploit()
